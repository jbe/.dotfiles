#!/usr/bin/env ruby

def nasty_require(*gems)
  gems.each do |gem|
    begin
      require gem
    rescue LoadError
      puts " > installing # {gem}"
      system "gem install #{gem}"
      require gem
    end
  end
end

nasty_require(*%w(git-up))

def megasync(*paths)
  puts "Mega syncing: #{paths.join(' ')}"
  paths.map {|p| File.join(Dir.pwd, p) }.each do |dir|
    if File.directory? dir
      system "cd #{dir} && git add -A && git commit"
      Dir.chdir(dir)
      GitUp.new.run()
      system "cd #{dir} && git push"
    else
      exit "Not a directory: #{dir}"
    end
  end
end

ARGV << '.' if ARGV.empty?
megasync ARGV
